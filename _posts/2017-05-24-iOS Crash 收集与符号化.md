---
layout: post
title: iOS Crash æ”¶é›†ä¸ç¬¦å·åŒ–
categories: blog
description: ç¬¦å·åŒ–
keywords: Symbolicatecrash
---        
ç¡Œï¼Œå½“æˆ‘ä»¬æäº¤åˆ°AppStore ä¸Šçš„app å´©æºƒäº†ï¼Œæˆ‘æƒ³æ­¤æ—¶æˆ‘ä»¬çš„å†…å¿ƒä¹Ÿæ˜¯å´©æºƒçš„ã€‚æ­¤æ—¶ï¼Œæˆ‘ä»¬åº”è¯¥åšçš„å°±æ˜¯èµ¶ç´§ä»iTunes storeä¸Šä¸‹è½½crash logã€‚å¯æ˜¯crash logä¸‹è½½ä¸‹æ¥äº†ã€‚


ä¸‹è½½ä¸‹æ¥åï¼Œæ‰“å¼€ä¸€çœ‹
```
Last Exception Backtrace:
0   CoreFoundation 0x000000018708b100 0x186f80000 + 1093888
1   libobjc.A.dylib            0x00000001939441fc 0x19393c000 + 33276
2   CoreFoundation 0x000000018708b040 0x186f80000 + 1093696
3   ApteligentExampleApp 0x000000010003acc4 0x10002c000 + 60612
```


![](/images/blog/u=33664513923273981699fm=23gp=0.jpg)



ä½ èƒ½çœ‹å¾—æ‡‚å—ï¼Œåæ­£æˆ‘æ˜¯çœ‹ä¸æ‡‚ã€‚




åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œé‚£æˆ‘ä»¬å°±å¿…é¡»ç¬¦å·åŒ–è¿™ä¸ªcrash log æ–‡ä»¶ï¼Œä»¥ä¾¿æˆ‘ä»¬èƒ½çœ‹æ‡‚




è¿™æ—¶æˆ‘ä»¬è‡ªç„¶æƒ³åˆ°atos æ¥ç¬¦å·åŒ–äº†
```
atos -arch <Binary Architecture> -o <Path to dSYM file>/Contents/Resources/DWARF/<binary image name> -l <load address> <address to symbolicate>
```             
æœ‰æ—¶å¯èƒ½å¹¶æ²¡æœ‰ç¬¦å·åŒ–å¹¶ä¸èµ·æ•ˆï¼Œé‚£ä½ å¯è¦å¥½å¥½æ£€æŸ¥ä½ æ‹¿åˆ°çš„.dsymå’Œ.app æ˜¯å¦æ˜¯æ­£ç¡®çš„ã€‚ä½ å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼æ¥æ£€æŸ¥ï¼š



        
>æ³¨æ„ï¼šæ¯ä¸€ä¸ªäºŒè¿›åˆ¶éƒ½ä¸€ä¸ªUUIDï¼Œcrash log ä¹ŸåŒ…å«ä¸€ä¸ªUUIDï¼Œå³ä½¿æ˜¯ç›¸åŒçš„ä»£ç ï¼Œç›¸åŒçš„ç¼–è¯‘è®¾ç½®,é‡æ–°ç¼–è¯‘ä¹Ÿä¼šäº§ç”Ÿä¸åŒçš„UUIDã€‚          



åºŸè¯ä¸å¤šè¯´ï¼Œå…ˆæ¥çœ‹çœ‹crashæ–‡ä»¶       
````
$ grep --after-context=2 "Binary Images:" ~/Desktop/crashlog/DemoSandbox.crash      
Binary Images:
0x100048000 - 0x100053fff DemoSandbox arm64  <a913f9e410ab3389a4bb7a03c4343d60> /var/mobile/Containers/Bundle/Application/DCCE1746-C533-4F40-85D3-41EFC4B87EF4/DemoSandbox.app/DemoSandbox
0x10007c000 - 0x10007ffff MobileSubstrate.dylib arm64  <3134cfb2f722310ea2c742ae4dc131ab> /Library/MobileSubstrate/MobileSubstrate.dylib
0x1002ec000 - 0x1002effff SubstrateLoader.dylib arm64      
````


æ­¤æ—¶çš„ <b> a913f9e410ab3389a4bb7a03c4343d60 </b> å°±æ˜¯è¿™ä»½crash log å¯¹åº”çš„äºŒçº§åˆ¶çš„UUIDäº†ã€‚å†æ¥çœ‹çœ‹äºŒè¿›åˆ¶çš„UUIDã€‚
```
$ xcrun dwarfdump --uuid /Users/heyonly/Library/Developer/Xcode/DerivedData/emm-gcfmioqsbcxmerceaefbrzjkatft/Build/Products/Debug-iphoneos/DemoSandbox.app/DemoSandbox 
UUID: A913F9E4-10AB-3389-A4BB-7A03C4343D60 (arm64) /Users/heyonly/Library/Developer/Xcode/DerivedData/emm-gcfmioqsbcxmerceaefbrzjkatft/Build/Products/Debug-iphoneos/DemoSandbox.app/DemoSandbox
```
è¿™ä¸ªappæœ‰2ä¸ªUUIDï¼Œè¡¨æ˜å®ƒæ˜¯ä¸€ä¸ªfat binaray

åŒæ ·æ£€æŸ¥ä½ çš„.dsym æ–‡ä»¶ä¸­ï¼š
```
$ xcrun dwarfdump --uuid /Users/heyonly/Library/Developer/Xcode/DerivedData/emm-gcfmioqsbcxmerceaefbrzjkatft/Build/Products/Debug-iphoneos/DemoSandbox.app.dSYM/Contents/Resources/DWARF/DemoSandbox 
UUID: A913F9E4-10AB-3389-A4BB-7A03C4343D60 (arm64) /Users/heyonly/Library/Developer/Xcode/DerivedData/emm-gcfmioqsbcxmerceaefbrzjkatft/Build/Products/Debug-iphoneos/DemoSandbox.app.dSYM/Contents/Resources/DWARF/DemoSandbox
```
å—¯ï¼Œä¸‰ä¸ªæ–‡ä»¶å¯¹åº”èµ·æ¥äº†ã€‚

<h4>symbolicatecrash</h4>

symbolicatecrashæ˜¯ä¸€å€‹å°‡å †æ£§åœ°å€ç¬¦è™ŸåŒ–çš„è…³æœ¬ï¼Œè¼¸å…¥åƒæ•¸æ˜¯è˜‹æœå®˜æ–¹æ ¼å¼çš„å´©æ½°æ—¥èªŒåŠæœ¬åœ°çš„.dSYMæ–‡ä»¶ï¼Œ
åŸ·è¡Œæ–¹å¼å¦‚ä¸‹ï¼š
Symbolicatecrash + å´©æ½°æ—¥èªŒ + APPå°æ‡‰çš„.dSYMæ–‡ä»¶ + > + è¼¸å‡ºåˆ°çš„æ–‡ä»¶ï¼Œ
ä½†ä½¿ç”¨symbolicatecrashå·¥å…·æœ‰å¾ˆå¤§çš„é™åˆ¶
(1)åªèƒ½åˆ†æå®˜æ–¹æ ¼å¼çš„å´©æ½°æ—¥èªŒï¼Œéœ€è¦å¾å…·é«”çš„è¨­å‚™ä¸­å°å‡ºï¼Œç²å–å’Œæ“ä½œéƒ½ä¸æ˜¯å¾ˆæ–¹ä¾¿
(2)ç¬¦è™ŸåŒ–çš„çµæœä¹Ÿæ˜¯æ²’æœ‰å…·é«”çš„è¡Œè™Ÿä¿¡æ¯çš„ï¼Œä¹Ÿç¶“å¸¸æœƒå‡ºç¾ç¬¦è™ŸåŒ–å¤±æ•—çš„æƒ…æ³ã€‚


å¯¦éš›ä¸Š, Xcodeçš„Organizerå…§ç½®äº†symbolicatecrashå·¥å…·ï¼Œæ‰€ä»¥é–‹ç™¼è€…æ‰å¯ä»¥ç›´æ¥çœ‹åˆ°ç¬¦è™ŸåŒ–çš„å´©æ½°å †æ£§æ—¥èªŒã€‚




<h4>atos</h4>

æˆ‘ä»¬çŸ¥é“APPå¯åŠ¨éƒ½æœ‰ä¸€ä¸ªæ¨¡å—åŠ è½½åœ°å€å’Œåç§»åœ°å€ï¼Œä»–ä»¬çš„å…³ç³»æ˜¯æ€ä¹ˆæ ·çš„å‘¢ã€‚ä¸‹é¢ç”¨ä¸€å¼ å›¾æ¥è¯´æ˜ï¼š
```
Last Exception Backtrace:
0   CoreFoundation 0x000000018708b100 0x186f80000 + 1093888
1   libobjc.A.dylib            0x00000001939441fc 0x19393c000 + 33276
2   CoreFoundation 0x000000018708b040 0x186f80000 + 1093696
3   ApteligentExampleApp 0x000000010003acc4 0x10002c000 + 60612
```

```
Binary Images:
0x10002c000 - 0x1000dffff ApteligentExampleApp arm64  <3759a98e880336108b1a799afa3c1adc> /var/mobile/Applications/46FB38F8-0E69-459F-B96A-CEEA21B77D55/ApteligentExampleApp.app/ApteligentExampleApp
```


![](/images/blog/loadAddressAndSlide.png)


æœ‰äº†è¿™äº›æ¦‚å¿µåï¼Œæˆ‘ä»¬å°±æ¥åˆ†æcrash log äº†ã€‚



<h4>ç¬¦å·åŒ–ä½ çš„crash log</h4>
å½“ä½ è·å–åˆ°äº†crash logï¼Œç›¸å¯¹åº”çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œç¬¦å·åŒ–æ–‡ä»¶ï¼Œä¸‰è€…éƒ½å¯¹åº”åï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼Œç›´æ¥ä¸€é”®ç¬¦å·åŒ–ã€‚
```
atos -arch <Binary Architecture> -o <Path to dSYM file>/Contents/Resources/DWARF/<binary image name> -l <load address> <address to symbolicate>
```
å¦‚ä¸Šå›¾ï¼š



```
atos -arch arm64 -o ApteligentExampleApp.dSYM -l 0x10002c000 0x000000010003acc4
-[ApteligentExampleClass buggyFunction] (in ApteligentExampleApp.dSYM) (ApteligentExampleClass.m:181)
```

è¿™æ²¡ä»€ä¹ˆé—®é¢˜ã€‚



æœ‰æ—¶å€™ï¼Œæˆ‘ä»¬æƒ³å·ä¸ªæ‡’ï¼Œæ²¡æœ‰å¿…è¦æ¢å¤æ€ä¹ˆç¬¦å·è¡¨ï¼Œåªè¦ç¨å¾®ç»™ç‚¹ä¿¡æ¯ï¼Œæˆ‘ä»¬å°±è§£å†³ï¼Œæˆ‘åªæƒ³çœ‹çœ‹crash åœ¨å“ªä¸ªå‡½æ•°ä¸­ã€‚


æ¯”å¦‚æœ‰è¿™ä¹ˆä¸€æ®µå´©æºƒä¿¡æ¯ï¼š
```
16  CoreFoundation                	0x183fddcd8 __CFRunLoopRun + 724
17  CoreFoundation                	0x183f0cca0 CFRunLoopRunSpecific + 384
18  UIKit                         	0x18962a1c8 -[UIApplication _run] + 460
19  UIKit                         	0x189624ffc UIApplicationMain + 204
20  DemoSandbox                   	0x1000e82a0 0x1000e0000 + 33440
21  libdyld.dylib                 	0x19933a8b8 start + 4
```


```
Binary Images:
0x1000e0000 - 0x1000ebfff DemoSandbox arm64  <a913f9e410ab3389a4bb7a03c4343d60> /var/mobile/Containers/Bundle/Application/7839DCA5-8955-4796-8142-6932ACDB873A/DemoSandbox.app/DemoSandbox
```

è¿™æ ·æˆ‘ä»¬çœ‹çš„æ›´æ¸…æ¥šï¼Œ0x1000e0000å°±æ˜¯æˆ‘ä»¬æ¨¡å—çš„åŠ è½½åœ°å€


æ¥ä¸‹æ¥æˆ‘ä»¬åœ¨æ²¡æœ‰ç¬¦å·æ–‡ä»¶çš„æƒ…å†µä¸‹æ¥çœ‹çœ‹

```
$ atos -arch arm64 -o /Users/heyonly/Library/Developer/Xcode/DerivedData/emm-gcfmioqsbcxmerceaefbrzjkatft/Build/Products/Debug-iphoneos/DemoSandbox.app/DemoSandbox -l 0x1000e0000 0x1000e82a0
main (in DemoSandbox) (main.m:14)
```

è¿™æ ·æ˜¯ä¸æ˜¯å¾ˆæ¸…æ™°æ˜äº†



æœ‰äººå°±ä¼šè¯´ï¼Œæˆ‘ä»¬å¼€å‘çš„æˆ‘ä»¬éƒ½ä¼šæœ‰ç¬¦å·æ–‡ä»¶ã€‚å—¯ï¼Œæœ‰ä¸€ç§æƒ…å†µä¼šç”¨çš„åˆ°ï¼Œåœ¨åšéè¶Šç‹±æ‰‹æœºè¿›è¡Œå¼€å‘çš„æ—¶å€™å¾ˆç®¡ç”¨
ä¸ºæ­¤ï¼Œæˆ‘ä¸“é—¨å†™äº†ä¸ªè„šæœ¬,è¿›è¡Œè‡ªåŠ¨åŒ–åˆ†æï¼Œè¿˜å¯ä»¥ï¼ŒæŒºç®¡ç”¨çš„





é¡¹ç›®åœ°å€ï¼š[https://github.com/heyonly/hbsymbolicate](https://github.com/heyonly/hbsymbolicate  "hbsymbolicate")



å¾ˆæ–¹ä¾¿ï¼š
```
sh symbol.sh -l <path/ipa.crash> -b <path/example.app/example> -o destination.crash
```

ä¸æ˜¯å¾ˆå¥½ç”¨ï¼Œæˆ‘æœ‰æ—¶é—´ä¼šæ¥ä¼˜åŒ–ä¼˜åŒ–




<h4>æ€»ç»“</h4>

æœ‰ç‚¹ä¹±ï¼Œæ…¢æ…¢å°±ä¼šå¥½äº†ï¼Œæ¬¢è¿æ‹ç –,è²Œä¼¼æ‹ç –è¦æ­æ¢¯å­å“¦ğŸ˜¯



å‚è§ï¼š

[1]\:[https://www.apteligent.com/technical-resource/symbolicating-an-ios-crash-report/](https://www.apteligent.com/technical-resource/symbolicating-an-ios-crash-report/   "apteligent")
[2]\:[https://developer.apple.com/library/content/technotes/tn2151/_index.html](https://developer.apple.com/library/content/technotes/tn2151/_index.html "apple")
[3]\:[https://developer.apple.com/library/content/technotes/tn2151/_index.html](https://developer.apple.com/library/content/technotes/tn2151/_index.html   "apple")
[4]\:[https://read01.com/nj6BRm.html](https://read01.com/nj6BRm.html)